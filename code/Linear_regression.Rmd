---
title: "linear regression"
author: "Yixuan Yang"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(phyloseq)
library(tidyverse)
library(here)
```

```{r}
ps <- read_rds(here('Rdata','following_study','ps.rds'))
ps.prop <- ps %>% transform_sample_counts(function(x) x / sum(x) )
meta_data <- sample_data(ps.prop) %>% unclass() %>% as.data.frame(stringsAsFactors = TRUE)
otu.prop <- otu_table(ps.prop) %>% as.data.frame()
test <- bind_cols(meta_data, otu.prop)
```

```{r}
result <- data.frame()
for (ASV in colnames(otu.prop)) {
    model <- lm(otu.prop[,ASV]~Group + Pheno.or.drug.naive, data = test)
    groupB <- (model %>% summary() %>%coef)['GroupB',] 
    result <- result %>% bind_rows(groupB)
}
rownames(result) <-  colnames(otu.prop)
colnames(result)[4] <- 'p.value'
sig <- result %>% filter(p.value <= 0.1) 
tax_table(ps)[rownames(sig),] %>% data.frame()
```

